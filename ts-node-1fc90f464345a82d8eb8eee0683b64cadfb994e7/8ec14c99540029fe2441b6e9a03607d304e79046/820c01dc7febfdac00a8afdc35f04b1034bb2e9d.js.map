{"version":3,"file":"/mnt/c/basidia/material2/tools/gulp/util/ts-compiler.ts","sources":["/mnt/c/basidia/material2/tools/gulp/util/ts-compiler.ts"],"names":[],"mappings":";AAAA,IAAY,EAAE,WAAM,YAAY,CAAC,CAAA;AACjC,IAAY,IAAI,WAAM,MAAM,CAAC,CAAA;AAC7B,IAAY,KAAK,WAAM,OAAO,CAAC,CAAA;AAE/B,iEAAiE;AACjE,wBAA+B,OAAe,EAAE,OAA2B;IACzE,IAAI,MAAM,GAAG,kBAAkB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IAClD,IAAI,OAAO,GAAG,EAAE,CAAC,aAAa,CAAC,MAAM,CAAC,SAAS,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;IACjE,IAAI,OAAO,GAAG,OAAO,CAAC,mBAAmB,EAAE,CAAC;IAE5C,yDAAyD;IACzD,iBAAiB,CAAC,OAAO,CAAC,qBAAqB,EAAE,EAAE,OAAO,CAAC,CAAC;IAE5D,IAAI,UAAU,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC;IAEhC,iBAAiB,CAAC,UAAU,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;AACrD,CAAC;AAXe,sBAAc,iBAW7B,CAAA;AAED,iDAAiD;AACjD,4BAA4B,OAAe,EAAE,OAA2B;IACtE,IAAI,MAAM,GAAG,EAAE,CAAC,cAAc,CAAC,OAAO,EAAE,EAAE,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC;IAChE,IAAI,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IAErC,IAAI,IAAI,GAAG;QACT,yBAAyB,EAAE,IAAI;QAC/B,UAAU,EAAE,EAAE,CAAC,GAAG,CAAC,UAAU;QAC7B,aAAa,EAAE,EAAE,CAAC,GAAG,CAAC,aAAa;QACnC,QAAQ,EAAE,EAAE,CAAC,GAAG,CAAC,QAAQ;KAC1B,CAAC;IAEF,MAAM,CAAC,EAAE,CAAC,0BAA0B,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;AACxE,CAAC;AAED,8DAA8D;AAC9D,2BAAkC,WAA4B,EAAE,OAAe;IAC7E,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,UAAA,UAAU;QAC/B,IAAI,GAAG,GAAG,YAAK,KAAK,CAAC,GAAG,CAAC,OAAK,UAAU,CAAC,IAAM,CAAC,QAAK,CAAC;QAEtD,EAAE,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;YACpB,IAAA,oEAAuF,EAAlF,cAAI,EAAE,wBAAS,CAAoE;YACxF,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAEhE,GAAG,IAAO,QAAQ,UAAI,IAAI,GAAG,CAAC,WAAI,SAAS,GAAG,CAAC,SAAK,CAAC;QACvD,CAAC;QACD,GAAG,IAAI,KAAG,EAAE,CAAC,4BAA4B,CAAC,UAAU,CAAC,WAAW,EAAE,IAAI,CAAG,CAAC;QAE1E,MAAM,CAAC,GAAG,CAAC;IACb,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAChB,CAAC;AAde,yBAAiB,oBAchC,CAAA;AAED,iDAAiD;AACjD,2BAAkC,WAA4B,EAAE,OAAgB;IAC9E,EAAE,CAAC,CAAC,WAAW,IAAI,WAAW,CAAC,MAAM,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACxD,OAAO,CAAC,KAAK,CAAC,iBAAiB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC,CAAC;QACvD,MAAM,IAAI,KAAK,CAAC,gCAAgC,CAAC,CAAC;IACpD,CAAC;AACH,CAAC;AALe,yBAAiB,oBAKhC,CAAA","sourcesContent":["import * as ts from 'typescript';\r\nimport * as path from 'path';\r\nimport * as chalk from 'chalk';\r\n\r\n/** Compiles a TypeScript project with possible extra options. */\r\nexport function compileProject(project: string, options: ts.CompilerOptions) {\r\n  let parsed = parseProjectConfig(project, options);\r\n  let program = ts.createProgram(parsed.fileNames, parsed.options);\r\n  let baseDir = program.getCurrentDirectory();\r\n\r\n  // Report any invalid TypeScript options for the project.\r\n  reportDiagnostics(program.getOptionsDiagnostics(), baseDir);\r\n\r\n  let emitResult = program.emit();\r\n\r\n  reportDiagnostics(emitResult.diagnostics, baseDir);\r\n}\r\n\r\n/** Parses a TypeScript project configuration. */\r\nfunction parseProjectConfig(project: string, options: ts.CompilerOptions) {\r\n  let config = ts.readConfigFile(project, ts.sys.readFile).config;\r\n  let basePath = path.dirname(project);\r\n\r\n  let host = {\r\n    useCaseSensitiveFileNames: true,\r\n    fileExists: ts.sys.fileExists,\r\n    readDirectory: ts.sys.readDirectory,\r\n    readFile: ts.sys.readFile\r\n  };\r\n\r\n  return ts.parseJsonConfigFileContent(config, host, basePath, options);\r\n}\r\n\r\n/** Formats the TypeScript diagnostics into a error string. */\r\nexport function formatDiagnostics(diagnostics: ts.Diagnostic[], baseDir: string): string {\r\n  return diagnostics.map(diagnostic => {\r\n    let res = `â€¢ ${chalk.red(`TS${diagnostic.code}`)} - `;\r\n\r\n    if (diagnostic.file) {\r\n      let {line, character} = diagnostic.file.getLineAndCharacterOfPosition(diagnostic.start);\r\n      let filePath = path.relative(baseDir, diagnostic.file.fileName);\r\n\r\n      res += `${filePath}(${line + 1},${character + 1}): `;\r\n    }\r\n    res += `${ts.flattenDiagnosticMessageText(diagnostic.messageText, '\\n')}`;\r\n\r\n    return res;\r\n  }).join('\\n');\r\n}\r\n\r\n/** Checks and reports diagnostics if present. */\r\nexport function reportDiagnostics(diagnostics: ts.Diagnostic[], baseDir?: string) {\r\n  if (diagnostics && diagnostics.length && diagnostics[0]) {\r\n    console.error(formatDiagnostics(diagnostics, baseDir));\r\n    throw new Error('TypeScript compilation failed.');\r\n  }\r\n}\r\n"]}